<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.AccessRecordMapper">

    <resultMap id="BaseResultMap" type="com.ruoyi.system.entity.AccessRecord">
        <id property="id" column="id" jdbcType="BIGINT"/>
        <result property="type" column="type" jdbcType="INTEGER"/>
        <result property="ipAddress" column="ip_address" jdbcType="BIGINT"/>
        <result property="second" column="second" jdbcType="BIGINT"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="visit" column="visit" jdbcType="BIGINT"/>
        <result property="register" column="register" jdbcType="BIGINT"/>
        <result property="province" column="province" jdbcType="VARCHAR"/>
        <result property="city" column="city" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
        id
        ,type,ip_address,
        second,create_time,visit,
        register,province,city
    </sql>
    <select id="selectAmount" resultType="com.ruoyi.system.entity.AccessRecord">
        SELECT
        system.access_record.type,
        SUM(system.access_record.ip_address) as ip_address,
        SUM(system.access_record.`second`) as second,
        SUM(system.access_record.visit) as visit,
        SUM(system.access_record.register) as register
        FROM
        system.access_record
        <where>
            <if test="accessRecordQuery.region !='' and accessRecordQuery.region !=null ">
                (
                system.access_record.province LIKE CONCAT('%',#{accessRecordQuery.region}, '%') OR
                system.access_record.city LIKE CONCAT('%',#{accessRecordQuery.region}, '%')
                )
            </if>
            <if test="accessRecordQuery.beginTime !=null and accessRecordQuery.endTime !=null">
                and system.access_record.create_time BETWEEN #{accessRecordQuery.beginTime} AND
                #{accessRecordQuery.endTime}
            </if>
            <if test="accessRecordQuery.beginTime !=null and accessRecordQuery.endTime ==null">
                and system.access_record.create_time > #{accessRecordQuery.beginTime}
            </if>
            <if test="accessRecordQuery.beginTime ==null and accessRecordQuery.endTime !=null">
                and system.access_record.create_time &lt; #{accessRecordQuery.endTime}
            </if>
        </where>

        GROUP BY
        system.access_record.type

    </select>
    <select id="intraday" resultType="com.ruoyi.system.entity.AccessRecord">
        SELECT
        access_record.type,
        SUM(access_record.ip_address) as ip_address,
        SUM(access_record.`second`) as second,
        SUM(access_record.visit) as visit,
        SUM(access_record.register) as register
        FROM
        access_record
        <where>
            <if test="beginTime ==null and endTime ==null">
                to_days(create_time) = to_days(now())
            </if>

            <if test="beginTime !=null and endTime !=null">
                and .access_record.create_time BETWEEN #{beginTime} AND
                #{endTime}
            </if>
            <if test="beginTime !=null and endTime ==null">
                and access_record.create_time > #{beginTime}
            </if>
            <if test="beginTime ==null and endTime !=null">
                and .access_record.create_time &lt; #{endTime}
            </if>
        </where>

        GROUP BY
        access_record.type

    </select>
</mapper>
