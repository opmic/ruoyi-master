<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.company.mapper.TJobhunterWorkRecordMapper">

    <resultMap id="BaseResultMap" type="com.ruoyi.company.entity.TJobhunterWorkRecord">
            <id property="workId" column="work_id" jdbcType="VARCHAR"/>
            <result property="resumeId" column="resume_id" jdbcType="VARCHAR"/>
            <result property="companyName" column="company_name" jdbcType="VARCHAR"/>
            <result property="industry" column="industry" jdbcType="VARCHAR" typeHandler="com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler"/>
            <result property="department" column="department" jdbcType="VARCHAR"/>
            <result property="position" column="position" jdbcType="VARCHAR"/>
            <result property="positionName" column="position_name" jdbcType="VARCHAR"/>
            <result property="startTime" column="start_time" jdbcType="VARCHAR"/>
            <result property="endTime" column="end_time" jdbcType="VARCHAR"/>
            <result property="jobDescription" column="job_description" jdbcType="VARCHAR"/>
            <result property="content" column="content" jdbcType="VARCHAR"/>
            <result property="visible" column="visible" jdbcType="INTEGER"/>
            <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
            <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        work_id,resume_id,company_name,
        industry,department,position,
        position_name,start_time,end_time,
        job_description,content,visible,
        create_time,update_time
    </sql>
    <select id="listIds" resultMap="BaseResultMap">
        SELECT
            t_jobhunter_work_record.work_id,
            t_jobhunter_work_record.resume_id,
            t_jobhunter_work_record.company_name,
            t_jobhunter_work_record.position_name

        FROM
            t_jobhunter_work_record  as t_jobhunter_work_record
                INNER JOIN
            (SELECT
                 MAX(t_jobhunter_work_record.create_time) as time,
	t_jobhunter_work_record.resume_id
             FROM
                 t_jobhunter_work_record
        <where>
            <if test="records !=null and records.size>0">
                t_jobhunter_work_record.resume_id IN
                <foreach collection="records" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
        </where>
             GROUP BY
                 t_jobhunter_work_record.resume_id ) AS B
            ON
                    B.resume_id=t_jobhunter_work_record.resume_id and B.time=t_jobhunter_work_record.create_time

        <where>
            <if test="records !=null and records.size>0">
                t_jobhunter_work_record.resume_id IN
                <foreach collection="records" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
        </where>


        GROUP BY
            t_jobhunter_work_record.resume_id
    </select>
</mapper>
